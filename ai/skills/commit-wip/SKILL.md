---
name: commit
description: Create commit messages following conventional commit conventions. Use when committing code changes, writing git commits, or formatting git history. Follows standard conventional commit format with flexible conventions adapted for this repository.
---

# Commit Messages

Follow these conventions when creating commits for this repository.

## Step 1: Check Branch (Optional)

Before committing, check if you're on a feature branch:

```bash
git branch --show-current
```

If on `main` or `master`, ask the user if they want to create a new branch:

> "You're currently on `main`. Would you like to create a new branch before committing?"

If yes, use the `question` tool to get the branch name:

```markdown
question({
  "questions": [{
    "question": "What would you like to name this branch?",
    "header": "Branch name",
    "options": [
      {"label": "Use suggested name", "description": "Accept the AI-generated branch name based on the changes"}
    ]
  }]
})
```

If they choose "Use suggested name", generate a single descriptive branch name based on the commit type and changes. Common patterns include:
- `<type>/<description>` (e.g., `feat/add-login`, `fix/null-check`)
- Descriptive names without type prefix (e.g., `add-user-auth`, `fix-null-pointer`, `refactor-validation`)

The question tool includes a "Type your own answer" option by default for custom branch names.

Then create the branch:

```bash
git checkout -b <user-selected-branch-name>
```

## Step 2: Stage Changes

Check what changes will be committed:

```bash
git status
git diff --cached
```

Stage appropriate files:

```bash
# Stage all changes
git add .

# Or stage specific files
git add <file1> <file2>
```

## Step 3: Determine Commit Type

Analyze the staged changes and select the appropriate type:

| Type | Purpose |
|------|---------|
| `feat` | New feature |
| `fix` | Bug fix |
| `ref` | Refactoring (no behavior change) |
| `perf` | Performance improvement |
| `docs` | Documentation only |
| `test` | Test additions or corrections |
| `build` | Build system or dependencies |
| `ci` | CI configuration |
| `chore` | Maintenance tasks |
| `style` | Code formatting (no logic change) |
| `meta` | Repository metadata |
| `license` | License changes |

## Step 4: Write the Commit Message

### Format

```
<type>(<scope>): <subject>

<body>
```

The header is required. Scope is optional. All lines must stay under 100 characters.

### Subject Line Rules

- Use imperative, present tense: "Add feature" not "Added feature"
- Capitalize the first letter
- No period at the end
- Maximum 70 characters

### Body Guidelines

- Explain **what** and **why**, not how
- Use imperative mood and present tense
- Include motivation for the change
- Contrast with previous behavior when relevant
- Keep body focused and concise

## Step 5: Create the Commit

```bash
git commit -m "<type>(<scope>): <subject>" -m "<body>"
```

Or use the editor for multi-line commits:

```bash
git commit
```

## Examples

### Simple fix

```
fix(api): Handle null response in user endpoint

The user API could return null for deleted accounts, causing a crash
in the dashboard. Add null check before accessing user properties.
```

### Feature with scope

```
feat(alerts): Add Slack thread replies for alert updates

When an alert is updated or resolved, post a reply to the original
Slack thread instead of creating a new message. This keeps related
notifications grouped together.
```

### Refactor

```
ref: Extract common validation logic to shared module

Move duplicate validation code from three endpoints into a shared
validator class. No behavior change.
```

### Documentation

```
docs: Update README with new configuration options

Add documentation for the recently added environment variables
and their default values.
```

### Breaking change

```
feat(api)!: Remove deprecated v1 endpoints

Remove all v1 API endpoints that were deprecated in version 23.1.
Clients should migrate to v2 endpoints.

BREAKING CHANGE: v1 endpoints no longer available
```

## Revert Format

```
revert: feat(api): Add new endpoint

This reverts commit abc123def456.

Reason: Caused performance regression in production.
```

## Principles

- Each commit should be a single, stable change
- Commits should be independently reviewable
- The repository should be in a working state after each commit
- No AI attribution markers in commits (no "Generated by AI", "Co-Authored-By", etc.)
- No issue references in commit messages (keep commits focused on the change itself)

## Troubleshooting

**Empty commit message error:**
```bash
# Abort and try again
git commit --abort  # or Ctrl+C in editor
git commit
```

**Forgot to stage files:**
```bash
# Amend the last commit
git add <forgotten-file>
git commit --amend --no-edit
```

**Wrong commit message:**
```bash
# Amend with new message
git commit --amend -m "<new-message>"
```
